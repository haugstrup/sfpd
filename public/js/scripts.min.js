/*! sfpd 2014-07-28 */
"use strict";!function(window,angular,undefined){function isValidDottedPath(path){return null!=path&&""!==path&&"hasOwnProperty"!==path&&MEMBER_NAME_REGEX.test("."+path)}function lookupDottedPath(obj,path){if(!isValidDottedPath(path))throw $resourceMinErr("badmember",'Dotted member path "@{0}" is invalid.',path);for(var keys=path.split("."),i=0,ii=keys.length;ii>i&&obj!==undefined;i++){var key=keys[i];obj=null!==obj?obj[key]:undefined}return obj}function shallowClearAndCopy(src,dst){dst=dst||{},angular.forEach(dst,function(value,key){delete dst[key]});for(var key in src)!src.hasOwnProperty(key)||"$"===key.charAt(0)&&"$"===key.charAt(1)||(dst[key]=src[key]);return dst}var $resourceMinErr=angular.$$minErr("$resource"),MEMBER_NAME_REGEX=/^(\.[a-zA-Z_$][0-9a-zA-Z_$]*)+$/;angular.module("ngResource",["ng"]).factory("$resource",["$http","$q",function($http,$q){function encodeUriSegment(val){return encodeUriQuery(val,!0).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function encodeUriQuery(val,pctEncodeSpaces){return encodeURIComponent(val).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,pctEncodeSpaces?"%20":"+")}function Route(template,defaults){this.template=template,this.defaults=defaults||{},this.urlParams={}}function resourceFactory(url,paramDefaults,actions){function extractParams(data,actionParams){var ids={};return actionParams=extend({},paramDefaults,actionParams),forEach(actionParams,function(value,key){isFunction(value)&&(value=value()),ids[key]=value&&value.charAt&&"@"==value.charAt(0)?lookupDottedPath(data,value.substr(1)):value}),ids}function defaultResponseInterceptor(response){return response.resource}function Resource(value){shallowClearAndCopy(value||{},this)}var route=new Route(url);return actions=extend({},DEFAULT_ACTIONS,actions),forEach(actions,function(action,name){var hasBody=/^(POST|PUT|PATCH)$/i.test(action.method);Resource[name]=function(a1,a2,a3,a4){var data,success,error,params={};switch(arguments.length){case 4:error=a4,success=a3;case 3:case 2:if(!isFunction(a2)){params=a1,data=a2,success=a3;break}if(isFunction(a1)){success=a1,error=a2;break}success=a2,error=a3;case 1:isFunction(a1)?success=a1:hasBody?data=a1:params=a1;break;case 0:break;default:throw $resourceMinErr("badargs","Expected up to 4 arguments [params, data, success, error], got {0} arguments",arguments.length)}var isInstanceCall=this instanceof Resource,value=isInstanceCall?data:action.isArray?[]:new Resource(data),httpConfig={},responseInterceptor=action.interceptor&&action.interceptor.response||defaultResponseInterceptor,responseErrorInterceptor=action.interceptor&&action.interceptor.responseError||undefined;forEach(action,function(value,key){"params"!=key&&"isArray"!=key&&"interceptor"!=key&&(httpConfig[key]=copy(value))}),hasBody&&(httpConfig.data=data),route.setUrlParams(httpConfig,extend({},extractParams(data,action.params||{}),params),action.url);var promise=$http(httpConfig).then(function(response){var data=response.data,promise=value.$promise;if(data){if(angular.isArray(data)!==!!action.isArray)throw $resourceMinErr("badcfg","Error in resource configuration. Expected response to contain an {0} but got an {1}",action.isArray?"array":"object",angular.isArray(data)?"array":"object");action.isArray?(value.length=0,forEach(data,function(item){value.push(new Resource(item))})):(shallowClearAndCopy(data,value),value.$promise=promise)}return value.$resolved=!0,response.resource=value,response},function(response){return value.$resolved=!0,(error||noop)(response),$q.reject(response)});return promise=promise.then(function(response){var value=responseInterceptor(response);return(success||noop)(value,response.headers),value},responseErrorInterceptor),isInstanceCall?promise:(value.$promise=promise,value.$resolved=!1,value)},Resource.prototype["$"+name]=function(params,success,error){isFunction(params)&&(error=success,success=params,params={});var result=Resource[name].call(this,params,this,success,error);return result.$promise||result}}),Resource.bind=function(additionalParamDefaults){return resourceFactory(url,extend({},paramDefaults,additionalParamDefaults),actions)},Resource}var DEFAULT_ACTIONS={get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},remove:{method:"DELETE"},"delete":{method:"DELETE"}},noop=angular.noop,forEach=angular.forEach,extend=angular.extend,copy=angular.copy,isFunction=angular.isFunction;return Route.prototype={setUrlParams:function(config,params,actionUrl){var val,encodedVal,self=this,url=actionUrl||self.template,urlParams=self.urlParams={};forEach(url.split(/\W/),function(param){if("hasOwnProperty"===param)throw $resourceMinErr("badname","hasOwnProperty is not a valid parameter name.");!new RegExp("^\\d+$").test(param)&&param&&new RegExp("(^|[^\\\\]):"+param+"(\\W|$)").test(url)&&(urlParams[param]=!0)}),url=url.replace(/\\:/g,":"),params=params||{},forEach(self.urlParams,function(_,urlParam){val=params.hasOwnProperty(urlParam)?params[urlParam]:self.defaults[urlParam],angular.isDefined(val)&&null!==val?(encodedVal=encodeUriSegment(val),url=url.replace(new RegExp(":"+urlParam+"(\\W|$)","g"),function(match,p1){return encodedVal+p1})):url=url.replace(new RegExp("(/?):"+urlParam+"(\\W|$)","g"),function(match,leadingSlashes,tail){return"/"==tail.charAt(0)?tail:leadingSlashes+tail})}),url=url.replace(/\/+$/,"")||"/",url=url.replace(/\/\.(?=\w+($|\?))/,"."),config.url=url.replace(/\/\\\./,"/."),forEach(params,function(value,key){self.urlParams[key]||(config.params=config.params||{},config.params[key]=value)})}},resourceFactory}])}(window,window.angular),function(window,angular){function $SanitizeProvider(){this.$get=["$$sanitizeUri",function($$sanitizeUri){return function(html){var buf=[];return htmlParser(html,htmlSanitizeWriter(buf,function(uri,isImage){return!/^unsafe/.test($$sanitizeUri(uri,isImage))})),buf.join("")}}]}function sanitizeText(chars){var buf=[],writer=htmlSanitizeWriter(buf,angular.noop);return writer.chars(chars),buf.join("")}function makeMap(str){var i,obj={},items=str.split(",");for(i=0;i<items.length;i++)obj[items[i]]=!0;return obj}function htmlParser(html,handler){function parseStartTag(tag,tagName,rest,unary){if(tagName=angular.lowercase(tagName),blockElements[tagName])for(;stack.last()&&inlineElements[stack.last()];)parseEndTag("",stack.last());optionalEndTagElements[tagName]&&stack.last()==tagName&&parseEndTag("",tagName),unary=voidElements[tagName]||!!unary,unary||stack.push(tagName);var attrs={};rest.replace(ATTR_REGEXP,function(match,name,doubleQuotedValue,singleQuotedValue,unquotedValue){var value=doubleQuotedValue||singleQuotedValue||unquotedValue||"";attrs[name]=decodeEntities(value)}),handler.start&&handler.start(tagName,attrs,unary)}function parseEndTag(tag,tagName){var i,pos=0;if(tagName=angular.lowercase(tagName))for(pos=stack.length-1;pos>=0&&stack[pos]!=tagName;pos--);if(pos>=0){for(i=stack.length-1;i>=pos;i--)handler.end&&handler.end(stack[i]);stack.length=pos}}var index,chars,match,stack=[],last=html;for(stack.last=function(){return stack[stack.length-1]};html;){if(chars=!0,stack.last()&&specialElements[stack.last()])html=html.replace(new RegExp("(.*)<\\s*\\/\\s*"+stack.last()+"[^>]*>","i"),function(all,text){return text=text.replace(COMMENT_REGEXP,"$1").replace(CDATA_REGEXP,"$1"),handler.chars&&handler.chars(decodeEntities(text)),""}),parseEndTag("",stack.last());else if(0===html.indexOf("<!--")?(index=html.indexOf("--",4),index>=0&&html.lastIndexOf("-->",index)===index&&(handler.comment&&handler.comment(html.substring(4,index)),html=html.substring(index+3),chars=!1)):DOCTYPE_REGEXP.test(html)?(match=html.match(DOCTYPE_REGEXP),match&&(html=html.replace(match[0],""),chars=!1)):BEGING_END_TAGE_REGEXP.test(html)?(match=html.match(END_TAG_REGEXP),match&&(html=html.substring(match[0].length),match[0].replace(END_TAG_REGEXP,parseEndTag),chars=!1)):BEGIN_TAG_REGEXP.test(html)&&(match=html.match(START_TAG_REGEXP),match&&(html=html.substring(match[0].length),match[0].replace(START_TAG_REGEXP,parseStartTag),chars=!1)),chars){index=html.indexOf("<");var text=0>index?html:html.substring(0,index);html=0>index?"":html.substring(index),handler.chars&&handler.chars(decodeEntities(text))}if(html==last)throw $sanitizeMinErr("badparse","The sanitizer was unable to parse the following block of html: {0}",html);last=html}parseEndTag()}function decodeEntities(value){if(!value)return"";var parts=spaceRe.exec(value),spaceBefore=parts[1],spaceAfter=parts[3],content=parts[2];return content&&(hiddenPre.innerHTML=content.replace(/</g,"&lt;"),content="textContent"in hiddenPre?hiddenPre.textContent:hiddenPre.innerText),spaceBefore+content+spaceAfter}function encodeEntities(value){return value.replace(/&/g,"&amp;").replace(NON_ALPHANUMERIC_REGEXP,function(value){return"&#"+value.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function htmlSanitizeWriter(buf,uriValidator){var ignore=!1,out=angular.bind(buf,buf.push);return{start:function(tag,attrs,unary){tag=angular.lowercase(tag),!ignore&&specialElements[tag]&&(ignore=tag),ignore||validElements[tag]!==!0||(out("<"),out(tag),angular.forEach(attrs,function(value,key){var lkey=angular.lowercase(key),isImage="img"===tag&&"src"===lkey||"background"===lkey;validAttrs[lkey]!==!0||uriAttrs[lkey]===!0&&!uriValidator(value,isImage)||(out(" "),out(key),out('="'),out(encodeEntities(value)),out('"'))}),out(unary?"/>":">"))},end:function(tag){tag=angular.lowercase(tag),ignore||validElements[tag]!==!0||(out("</"),out(tag),out(">")),tag==ignore&&(ignore=!1)},chars:function(chars){ignore||out(encodeEntities(chars))}}}var $sanitizeMinErr=angular.$$minErr("$sanitize"),START_TAG_REGEXP=/^<\s*([\w:-]+)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*>/,END_TAG_REGEXP=/^<\s*\/\s*([\w:-]+)[^>]*>/,ATTR_REGEXP=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,BEGIN_TAG_REGEXP=/^</,BEGING_END_TAGE_REGEXP=/^<\s*\//,COMMENT_REGEXP=/<!--(.*?)-->/g,DOCTYPE_REGEXP=/<!DOCTYPE([^>]*?)>/i,CDATA_REGEXP=/<!\[CDATA\[(.*?)]]>/g,NON_ALPHANUMERIC_REGEXP=/([^\#-~| |!])/g,voidElements=makeMap("area,br,col,hr,img,wbr"),optionalEndTagBlockElements=makeMap("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),optionalEndTagInlineElements=makeMap("rp,rt"),optionalEndTagElements=angular.extend({},optionalEndTagInlineElements,optionalEndTagBlockElements),blockElements=angular.extend({},optionalEndTagBlockElements,makeMap("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul")),inlineElements=angular.extend({},optionalEndTagInlineElements,makeMap("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var")),specialElements=makeMap("script,style"),validElements=angular.extend({},voidElements,blockElements,inlineElements,optionalEndTagElements),uriAttrs=makeMap("background,cite,href,longdesc,src,usemap"),validAttrs=angular.extend({},uriAttrs,makeMap("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,size,span,start,summary,target,title,type,valign,value,vspace,width")),hiddenPre=document.createElement("pre"),spaceRe=/^(\s*)([\s\S]*?)(\s*)$/;angular.module("ngSanitize",[]).provider("$sanitize",$SanitizeProvider),angular.module("ngSanitize").filter("linky",["$sanitize",function($sanitize){var LINKY_URL_REGEXP=/((ftp|https?):\/\/|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>]/,MAILTO_REGEXP=/^mailto:/;return function(text,target){function addText(text){text&&html.push(sanitizeText(text))}function addLink(url,text){html.push("<a "),angular.isDefined(target)&&(html.push('target="'),html.push(target),html.push('" ')),html.push('href="'),html.push(url),html.push('">'),addText(text),html.push("</a>")}if(!text)return text;for(var match,url,i,raw=text,html=[];match=raw.match(LINKY_URL_REGEXP);)url=match[0],match[2]==match[3]&&(url="mailto:"+url),i=match.index,addText(raw.substr(0,i)),addLink(url,match[0].replace(MAILTO_REGEXP,"")),raw=raw.substring(i+match[0].length);return addText(raw),$sanitize(html.join(""))}}])}(window,window.angular),function(window,angular){function $RouteProvider(){function inherit(parent,extra){return angular.extend(new(angular.extend(function(){},{prototype:parent})),extra)}function pathRegExp(path,opts){var insensitive=opts.caseInsensitiveMatch,ret={originalPath:path,regexp:path},keys=ret.keys=[];return path=path.replace(/([().])/g,"\\$1").replace(/(\/)?:(\w+)([\?\*])?/g,function(_,slash,key,option){var optional="?"===option?option:null,star="*"===option?option:null;return keys.push({name:key,optional:!!optional}),slash=slash||"",""+(optional?"":slash)+"(?:"+(optional?slash:"")+(star&&"(.+?)"||"([^/]+)")+(optional||"")+")"+(optional||"")}).replace(/([\/$\*])/g,"\\$1"),ret.regexp=new RegExp("^"+path+"$",insensitive?"i":""),ret}var routes={};this.when=function(path,route){if(routes[path]=angular.extend({reloadOnSearch:!0},route,path&&pathRegExp(path,route)),path){var redirectPath="/"==path[path.length-1]?path.substr(0,path.length-1):path+"/";routes[redirectPath]=angular.extend({redirectTo:path},pathRegExp(redirectPath,route))}return this},this.otherwise=function(params){return this.when(null,params),this},this.$get=["$rootScope","$location","$routeParams","$q","$injector","$http","$templateCache","$sce",function($rootScope,$location,$routeParams,$q,$injector,$http,$templateCache,$sce){function switchRouteMatcher(on,route){var keys=route.keys,params={};if(!route.regexp)return null;var m=route.regexp.exec(on);if(!m)return null;for(var i=1,len=m.length;len>i;++i){var key=keys[i-1],val="string"==typeof m[i]?decodeURIComponent(m[i]):m[i];key&&val&&(params[key.name]=val)}return params}function updateRoute(){var next=parseRoute(),last=$route.current;next&&last&&next.$$route===last.$$route&&angular.equals(next.pathParams,last.pathParams)&&!next.reloadOnSearch&&!forceReload?(last.params=next.params,angular.copy(last.params,$routeParams),$rootScope.$broadcast("$routeUpdate",last)):(next||last)&&(forceReload=!1,$rootScope.$broadcast("$routeChangeStart",next,last),$route.current=next,next&&next.redirectTo&&(angular.isString(next.redirectTo)?$location.path(interpolate(next.redirectTo,next.params)).search(next.params).replace():$location.url(next.redirectTo(next.pathParams,$location.path(),$location.search())).replace()),$q.when(next).then(function(){if(next){var template,templateUrl,locals=angular.extend({},next.resolve);return angular.forEach(locals,function(value,key){locals[key]=angular.isString(value)?$injector.get(value):$injector.invoke(value)}),angular.isDefined(template=next.template)?angular.isFunction(template)&&(template=template(next.params)):angular.isDefined(templateUrl=next.templateUrl)&&(angular.isFunction(templateUrl)&&(templateUrl=templateUrl(next.params)),templateUrl=$sce.getTrustedResourceUrl(templateUrl),angular.isDefined(templateUrl)&&(next.loadedTemplateUrl=templateUrl,template=$http.get(templateUrl,{cache:$templateCache}).then(function(response){return response.data}))),angular.isDefined(template)&&(locals.$template=template),$q.all(locals)}}).then(function(locals){next==$route.current&&(next&&(next.locals=locals,angular.copy(next.params,$routeParams)),$rootScope.$broadcast("$routeChangeSuccess",next,last))},function(error){next==$route.current&&$rootScope.$broadcast("$routeChangeError",next,last,error)}))}function parseRoute(){var params,match;return angular.forEach(routes,function(route){!match&&(params=switchRouteMatcher($location.path(),route))&&(match=inherit(route,{params:angular.extend({},$location.search(),params),pathParams:params}),match.$$route=route)}),match||routes[null]&&inherit(routes[null],{params:{},pathParams:{}})}function interpolate(string,params){var result=[];return angular.forEach((string||"").split(":"),function(segment,i){if(0===i)result.push(segment);else{var segmentMatch=segment.match(/(\w+)(.*)/),key=segmentMatch[1];result.push(params[key]),result.push(segmentMatch[2]||""),delete params[key]}}),result.join("")}var forceReload=!1,$route={routes:routes,reload:function(){forceReload=!0,$rootScope.$evalAsync(updateRoute)}};return $rootScope.$on("$locationChangeSuccess",updateRoute),$route}]}function $RouteParamsProvider(){this.$get=function(){return{}}}function ngViewFactory($route,$anchorScroll,$animate){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(scope,$element,attr,ctrl,$transclude){function cleanupLastView(){previousElement&&(previousElement.remove(),previousElement=null),currentScope&&(currentScope.$destroy(),currentScope=null),currentElement&&($animate.leave(currentElement,function(){previousElement=null}),previousElement=currentElement,currentElement=null)}function update(){var locals=$route.current&&$route.current.locals,template=locals&&locals.$template;if(angular.isDefined(template)){var newScope=scope.$new(),current=$route.current,clone=$transclude(newScope,function(clone){$animate.enter(clone,null,currentElement||$element,function(){!angular.isDefined(autoScrollExp)||autoScrollExp&&!scope.$eval(autoScrollExp)||$anchorScroll()}),cleanupLastView()});currentElement=clone,currentScope=current.scope=newScope,currentScope.$emit("$viewContentLoaded"),currentScope.$eval(onloadExp)}else cleanupLastView()}var currentScope,currentElement,previousElement,autoScrollExp=attr.autoscroll,onloadExp=attr.onload||"";scope.$on("$routeChangeSuccess",update),update()}}}function ngViewFillContentFactory($compile,$controller,$route){return{restrict:"ECA",priority:-400,link:function(scope,$element){var current=$route.current,locals=current.locals;$element.html(locals.$template);var link=$compile($element.contents());if(current.controller){locals.$scope=scope;var controller=$controller(current.controller,locals);current.controllerAs&&(scope[current.controllerAs]=controller),$element.data("$ngControllerController",controller),$element.children().data("$ngControllerController",controller)}link(scope)}}}var ngRouteModule=angular.module("ngRoute",["ng"]).provider("$route",$RouteProvider);ngRouteModule.provider("$routeParams",$RouteParamsProvider),ngRouteModule.directive("ngView",ngViewFactory),ngRouteModule.directive("ngView",ngViewFillContentFactory),ngViewFactory.$inject=["$route","$anchorScroll","$animate"],ngViewFillContentFactory.$inject=["$compile","$controller","$route"]}(window,window.angular),angular.module("sfpdApp",["ngResource","ngSanitize","ngRoute","groupService","gameService"]).config(function($routeProvider,$httpProvider){$routeProvider.when("/",{templateUrl:"public/views/main.html",controller:"MainCtrl"}).when("/standings",{templateUrl:"public/views/standings.html",controller:"StandingsCtrl",resolve:{response:function($http){return $http.get("/api/seasons")}}}).when("/results",{templateUrl:"public/views/results.html",controller:"HeatsListCtrl",resolve:{response:function($http){return $http.get("/api/heats")}}}).when("/group/:code",{templateUrl:"public/views/group.html",controller:"GroupCtrl",resolve:{group:function($route,Groups){return Groups.get({code:$route.current.params.code})}}}).when("/game/:code",{templateUrl:"public/views/game.html",controller:"GameCtrl",resolve:{game:function($route,Games){return Games.get({code:$route.current.params.code})}}}).otherwise({redirectTo:"/"}),$httpProvider.interceptors.push(function($q,$rootScope){var count=0;return{request:function(config){return-1!==config.url.indexOf("/api/")&&(count++,$rootScope.$broadcast("loading-started")),config||$q.when(config)},response:function(response){return-1!==response.config.url.indexOf("/api/")&&(count--,0>=count&&$rootScope.$broadcast("loading-complete")),response||$q.when(response)},responseError:function(rejection){return $rootScope.$broadcast("loading-failed",rejection.status),$q.reject(rejection)}}})}).directive("loadingIndicator",function(){return{restrict:"A",template:"<div class='loading-indicator'><div class='bar-1'></div><div class='bar-2'></div><div class='bar-3'></div><div class='bar-4'></div><div class='bar-5'></div><div class='bar-6'></div><div class='bar-7'></div><div class='bar-8'></div></div>",link:function(scope,element){scope.$on("loading-started",function(){element.css({display:"block"})}),scope.$on("loading-complete",function(){element.css({display:"none"})}),scope.$on("loading-failed",function(e,status){switch(status){case 404:case 403:alert("Something went really wrong ("+status+"). Reload this page and try again.");break;default:alert("Something unknown went wrong. Reload this page and try again.")}})}}}),angular.module("gameService",["ngResource"]).factory("Games",function($resource){return $resource("/api/games/:code",{code:"@code"},{update:{method:"PUT",transformRequest:function(data){return JSON.stringify({status:data.status,results:data.results.map(function(result){return{player_id:result.player_id,position:result.position,result_id:result.result_id}})})}}})}),angular.module("groupService",["ngResource"]).factory("Groups",function($resource){return $resource("/api/groups/:code",{code:"@code"},{update:{method:"PUT",transformRequest:function(data){return JSON.stringify({players:data.players.map(function(player){return{player_id:player.player_id}})})}}})}),angular.module("sfpdApp").controller("GameCtrl",function($scope,$location,game){$scope.game=game,$scope.removeButtonDisabled=!1,$scope.saveButtonDisabledState=!1,$scope.positions=[{id:1,title:"1st"},{id:2,title:"2nd"},{id:3,title:"3rd"},{id:4,title:"4th"},{id:0,title:"Disqualified"},{id:-1,title:"Tardy player"}],$scope.canDelete=function(){var canDelete=!0;return angular.forEach($scope.game.results,function(result){null!==result.position&&(canDelete=!1)}),canDelete},$scope.removeGame=function(){var groupUrl="/group/"+$scope.game.group.code;$scope.removeButtonDisabled=!0,$scope.game.$delete(function(){$location.path(groupUrl)})},$scope.saveButtonDisabled=function(){return $scope.saveButtonDisabledState||!$scope.resultsValid()},$scope.resultsValid=function(){var usedPositions=[],resultsValid=!0,allNull=!0;return angular.forEach($scope.game.results,function(result){return allNull&&null!==result.position&&(allNull=!1),null===result.position||result.position>0&&-1!==usedPositions.indexOf(result.position)?void(resultsValid=!1):void usedPositions.push(result.position)}),allNull&&(resultsValid=!0),resultsValid},$scope.storeResults=function(){$scope.resultsValid()&&($scope.saveButtonDisabledState=!0,$scope.game.status="completed",$scope.game.$update(function(){$location.path("/group/"+game.group.code)}))}}),angular.module("sfpdApp").controller("GroupCtrl",function($scope,$location,group,$http,$filter){$scope.group=group,$scope.group.newPlayer=null,$scope.buttonDisabledState=!1,$scope.buttonDisabled=function(){return $scope.buttonDisabledState||!$scope.group.nextMachine},$scope.availableMachines=function(){return $scope.group.machines},$scope.pointsForPlayer=function(pointsList,playerId){var points=$filter("filter")(pointsList,{player_id:playerId},!0)[0];return points?points.points:"0"},$scope.gamePicked=function(player){var games=$filter("filter")($scope.group.games,{player_id:player.player_id},!0),names=games.map(function(game){return game.machine.name});return names.length?" picked "+names.join(", "):""},$scope.addPlayer=function(){$scope.group.newPlayer&&-1===$scope.group.players.indexOf($scope.group.newPlayer)&&($scope.group.players.push($scope.group.newPlayer),$scope.group.$update()),$scope.group.newPlayer=null},$scope.removePlayer=function(player){var index=$scope.group.players.indexOf(player);-1!==index&&($scope.group.players.splice(index,1),$scope.group.$update())},$scope.roomForPlayers=function(){return $scope.group.players?$scope.group.players.length<4:!0},$scope.nextPlayer=function(){if(!$scope.group.players)return null;if($scope.group.games.length>=4)return null;if(3===$scope.group.games.length&&3===$scope.group.players.length){var worstPlayer=null;return angular.forEach($scope.group.players,function(player){var currentPoints=$scope.pointsForPlayer($scope.group.points,player.player_id);(!worstPlayer||worstPlayer.totalPoints>currentPoints)&&(worstPlayer=player,worstPlayer.totalPoints=currentPoints)}),worstPlayer}var playersWhoHavePicked=$scope.group.games.map(function(game){return game.player.player_id}),availablePlayers=$filter("filter")($scope.group.players,function(player){return-1===playersWhoHavePicked.indexOf(player.player_id)});return availablePlayers[0]},$scope.startGame=function(){$scope.buttonDisabledState=!0;var url="/api/groups/"+$scope.group.code+"/games";$http.post(url,{machine:$scope.group.nextMachine,player:$scope.nextPlayer(),status:"active"}).success(function(group){$scope.group.games=group.games,angular.forEach(group.games,function(game){return"active"===game.status?void $location.path("/game/"+game.code):void 0})})}}),angular.module("sfpdApp").controller("HeatsListCtrl",function($scope,$filter,response){$scope.heats=response.data.heats,$scope.season=response.data.season,$scope.hasGamesFilter=function(group){return group.games.length>0},$scope.pointsForPlayer=function(pointsList,playerId){var points=$filter("filter")(pointsList,{player_id:playerId},!0)[0];return points?points.points:"0"}}),angular.module("sfpdApp").controller("MainCtrl",function($scope,$location){$scope.goToGroup=function(){$location.path("/group/"+$scope.code)}}).controller("HeaderCtrl",function($scope,$location){$scope.isActive=function(viewLocation){return viewLocation===$location.path()}}),angular.module("sfpdApp").controller("StandingsCtrl",function($scope,$filter,response){$scope.season=response.data,$scope.pointsForPlayerForHeat=function(pointsList,playerId){var points=$filter("filter")(pointsList,{player_id:playerId},!0)[0];return points?points.points:"0"}});
angular.module('sfpdApp').run(['$templateCache', function($templateCache) {
  'use strict';

  $templateCache.put('public/views/game.html',
    "<div ng-if=game.code><h2>{{game.machine.name}}</h2><p>{{game.group.heat.name}}, {{game.group.name}}. Picked by {{game.player.display_name}}</p><table class=\"table table-condensed table-vertical-center\"><thead><tr><th>Pos.</th><th>Player</th><th>Result</th></tr></thead><tbody><tr ng-repeat=\"result in game.results\"><td>{{result.delta+1}}</td><td>{{result.player.display_name}}</td><td><select class=\"form-control input-sm\" ng-disabled=\"game.group.heat.status !== 'active'\" ng-required ng-model=result.position ng-options=\"position.id as position.title for position in positions\"><option value=\"\">-- result --</option></select></td></tr></tbody></table><form><button class=\"btn btn-success\" ng-click=storeResults() ng-disabled=saveButtonDisabled() ng-show=\"game.group.heat.status === 'active'\">Save</button> <button class=\"btn btn-danger\" ng-click=removeGame() ng-disabled=removeButtonDisabled ng-show=canDelete()>Remove game</button> <a href=#/group/{{game.group.code}} class=\"btn btn-default\">Cancel</a></form></div>"
  );


  $templateCache.put('public/views/group.html',
    "<div ng-if=group.code><h2>{{group.heat.name}}, {{group.name}}</h2><table class=\"table table-unstyled table-vertical-center\"><tr ng-repeat=\"player in group.players\"><td>{{player.display_name}} {{gamePicked(player)}}</td><td><button class=\"btn btn-xs btn-danger\" ng-show=!group.games.length ng-click=removePlayer(player)>remove</button></td></tr></table><form ng-show=\"roomForPlayers() && !group.games.length\"><select class=\"form-control input-sm\" ng-required ng-model=group.newPlayer ng-options=\"player as player.display_name for player in group.season.players | orderBy:'display_name'\" ng-change=addPlayer()><option value=\"\">-- add player --</option></select></form><div ng-show=\"group.players.length >= 3\"><h3>Games</h3><table class=\"table table-scores\"><thead><tr><th>Player</th><th ng-repeat=\"game in group.games\" class=text-center><a title={{game.machine.name}} href=#/game/{{game.code}}>{{game.machine.shortname}}</a></th><th class=text-center><b>Total</b></th></tr></thead><tbody><tr ng-repeat=\"player in group.players\"><td>{{player.display_name}}</td><td ng-repeat=\"game in group.games\" class=text-center>{{ pointsForPlayer(game.results, player.player_id) }}pt.</td><td class=text-center><b>{{ pointsForPlayer(group.points, player.player_id) }}pt.</b></td></tr><tr><td>&nbsp;</td><td ng-repeat=\"game in group.games\" class=text-center><a href=#/game/{{game.code}}>edit</a></td><td>&nbsp;</td></tr></tbody></table><form class=form-inline ng-show=\"!(group.games|filter:{status:'active'}:true).length && group.games.length < 4\"><p><b>{{nextPlayer().display_name}}</b> should select the next game:</p><div class=form-group><select class=\"form-control input-sm\" ng-required ng-model=group.nextMachine ng-options=\"machine as machine.name for machine in availableMachines()\"><option value=\"\">-- select machine --</option></select></div><div class=form-group><button class=\"btn btn-success btn-sm\" ng-click=startGame() ng-disabled=buttonDisabled()>Start game</button></div></form></div></div>"
  );


  $templateCache.put('public/views/main.html',
    "<h2>Find your group</h2><form><div class=input-group><input type=search size=20 placeholder=\"Group code…\" class=\"form-control input-lg\" ng-model=code autocorrect=off autocapitalize=off> <span class=input-group-btn><button class=\"btn btn-success btn-lg\" ng-click=goToGroup()>Go!</button></span></div></form>"
  );


  $templateCache.put('public/views/results.html',
    "<ul class=list-unstyled><li ng-repeat=\"heat in heats\"><h2>{{season.name}}, {{heat.name}}</h2><ul class=list-unstyled><li ng-repeat=\"group in heat.groups | filter:hasGamesFilter\"><table class=\"table table-scores\"><thead><tr><th>{{group.name}}</th><th ng-repeat=\"game in group.games\" class=text-center title={{game.machine.name}}>{{game.machine.shortname}}</th><th class=text-center><b>Total</b></th></tr></thead><tbody><tr ng-repeat=\"player in group.players\"><td>{{player.display_name}}</td><td ng-repeat=\"game in group.games\" class=text-center>{{ pointsForPlayer(game.results, player.player_id) }}</td><td class=text-center><b>{{ pointsForPlayer(group.points, player.player_id) }}</b></td></tr></tbody></table></li></ul></li></ul>"
  );


  $templateCache.put('public/views/standings.html',
    "<table class=table><thead><tr><th>&nbsp;</th><th class=text-center ng-repeat=\"heat in season.heats\">{{heat.short_name}}</th><th class=text-center>Score</th></tr></thead><tbody><tr ng-repeat=\"seasonPoint in season.points | orderBy:'points':true\"><td>{{ (season.players|filter:{player_id:seasonPoint.player_id}:true)[0].display_name }}</td><td class=text-center ng-repeat=\"heat in season.heats\">{{pointsForPlayerForHeat(heat.points, seasonPoint.player_id)}}</td><td class=text-center><b>{{seasonPoint.points}}</b></td></tr></tbody></table>"
  );

}]);
